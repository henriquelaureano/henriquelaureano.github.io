---
title: "Laurence's 2022 solo daily activity"
author: Henrique Laureano (.github.io)
date: "*Last modification on* `r Sys.time()`"
output:
  html_document:
    code_folding: hide
---

```{r laurence,fig.width=10,fig.height=10}

if (!requireNamespace('pacman', quietly=TRUE)) install.packages('pacman')
pacman::p_load(tibble, lubridate, dplyr, stringr, haven, ggplot2,
               ggthemes, patchwork)
unique_color <- '#3e4989ff'
y <- c(0, 0, 2, 2, 2, 1, 1, 0, 0, 2, 2, 2, 1, 0, 0, 0, 0)
dat <-
    tibble::tibble(Day=seq(as.Date('2022-01-01'), lubridate::today(),
                           by='days'),
                   Count=haven::as_factor(y),
                   WeekDay=lubridate::wday(Day, label=TRUE), 
                   Week=lubridate::week(Day), 
                   Month=lubridate::month(Day, label=TRUE, abbr=FALSE))|>
    dplyr::mutate(WeekDay=stringr::str_to_title(WeekDay),
                  WeekDay=haven::as_factor(WeekDay),
                  Week=haven::as_factor(Week),
                  Month=stringr::str_to_title(Month),
                  Month=haven::as_factor(Month))
dat|>
    ggplot(aes(Week, WeekDay, fill=Count))+ 
    geom_tile(color='white')+ 
    facet_wrap(~ Month, scales='free', ncol=4)+ 
    scale_fill_viridis_d(direction=-1)+
    labs(title='Laurence’s 2022 solo daily activity',
         subtitle=paste0(
             sum(y), ' events (', round(mean(y), 2), ' per day)'
         ),
         x='Weeks')+
    ggthemes::theme_fivethirtyeight(base_size=14)+
    theme(strip.text.x=element_text(face='bold', size=14),
          legend.key.width=ggplot2::unit(0.75, 'cm'),
          legend.justification=c(1, 0),
          plot.subtitle=element_text(face='italic'),
          axis.title.x=element_text(
              face='bold',
              margin=ggplot2::unit(c(t=4, r=0, b=-6, l=0), 'mm')
          ))+
    guides(fill=guide_legend(title='Frequency:'))

```

```{r laurence_nomonths,fig.width=10,fig.height=3.5}

dat|>
    ggplot(aes(Week, WeekDay, fill=Count))+ 
    geom_tile(color='white')+ 
    scale_fill_viridis_d(direction=-1)+
    labs(title='Laurence’s 2022 solo daily activity',
         subtitle=paste0(
             sum(y), ' events (', round(mean(y), 2), ' per day)'
         ),
         x='Weeks')+
    ggthemes::theme_fivethirtyeight(base_size=14)+
    theme(legend.key.width=ggplot2::unit(0.75, 'cm'),
          legend.justification=c(1, 0),
          plot.subtitle=element_text(face='italic'),
          axis.text.x=element_blank(),
          axis.text.y=element_text(face='bold'),
          axis.title.x=element_text(
              face='bold',
              margin=ggplot2::unit(c(t=3, r=0, b=-6, l=0), 'mm')
          ))+
    guides(fill=guide_legend(title='Frequency:'))

```

```{r laurence_points_and_lines,fig.align='center',fig.width=10,fig.height=6.5,eval=FALSE}

dats <- dat|>
    dplyr::mutate(Count=as.numeric(Count))|>
    dplyr::group_by(Month)|>
    dplyr::summarise(n=sum(Count),
                     m=mean(Count))

p1 <- dats|>
    ggplot(aes(x=Month, y=n, group=1))+
    geom_hline(aes(yintercept=mean(n)),
               color='#ff0000', size=1, linetype='dashed')+
    annotate('text',
             x=1, y=2, label=paste('Mean:', mean(dats$n)), 
             fontface='bold', color='#ff0000')+
    geom_point(size=3, color=unique_color)+
    geom_line(size=1, color=unique_color)+
    geom_text(aes(label=n),
              vjust=0.4, hjust=-0.6, fontface='bold')+
    scale_x_discrete(breaks=NULL)+
    scale_y_continuous(breaks=seq(0, 6, by=2))+
    labs(title='Laurence’s 2022 solo daily activity',
         subtitle='Monthly raw counts')+
    ggthemes::theme_fivethirtyeight(base_size=14)+
    theme(plot.subtitle=element_text(
              face='italic', size=14,
              margin=ggplot2::unit(c(t=0, r=0, b=3, l=0), 'mm')
          ))

p2 <- dats|>
    ggplot(aes(x=Month, y=m, group=1))+
    geom_hline(aes(yintercept=mean(m)),
               color='#ff0000', size=1, linetype='dashed')+
    geom_text(aes(x='Janeiro', y=1,
                  label=paste('Mean:', round(mean(m), 2))), 
              fontface='bold', color='#ff0000')+
    geom_point(size=3, color=unique_color)+
    geom_line(size=1, color=unique_color)+
    geom_text(aes(label=round(m, 2)),
              vjust=0.4, hjust=-0.35, fontface='bold')+
    scale_x_discrete(limits=dats$Month)+
    scale_y_continuous(breaks=seq(0, 2, by=0.5))+
    labs(subtitle='Monthly average counts')+
    ggthemes::theme_fivethirtyeight(base_size=14)+
    theme(axis.text.x=element_text(face='bold', angle=30, hjust=1),
          plot.subtitle=element_text(
              face='italic', size=14,
              margin=ggplot2::unit(c(t=0, r=0, b=4, l=0), 'mm')
          ))

p1 / p2

```
