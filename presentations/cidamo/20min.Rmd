---
title: "Modelagem Estat\\(\\'{i}\\)stica da incid\\(\\^{e}\\)ncia de
        c\\(\\^{a}\\)nceres\\newline via um GLMM Multinomial"
# short-title: ""
author: "Henrique Laureano \\newline \\url{http://leg.ufpr.br/~henrique}"
short-author: "leg.ufpr.br/~henrique"
# email: "laureano\\@ufpr.br"
date: "\\href{https://cidamo.github.io/CiDWeek/}{CiDWeek I}, 03-07/02/2020"
short-date: "leg.ufpr.br/~henrique"
department: ""
institute: ""
# short-institute: "LEG"
section-titles: true
safe-columns: true # enables special latex macros for columns
output:
  legtheme::beamer_leg
---

```{r, include=FALSE}
library(knitr)

knit_hooks$set(rmdsize = function(before, options, envir) {
    if (before) "\\footnotesize"
    else "\\normalsize"
})

opts_chunk$set(rmdsize = TRUE,
               warning = FALSE,
               cache = TRUE,
               cache_path = "20min_cache/")
```

###

\vspace{.5cm}

\begin{columns}
 \begin{column}{.4\linewidth}
  \centering
   \includegraphics[width=.75\linewidth]{what.png}
 \end{column}
 \begin{column}{.6\linewidth}
  O qu\(\^{e}\)?
 \end{column}
\end{columns}

\begin{columns}
 \begin{column}{.4\linewidth}
  \centering
   \includegraphics[width=.75\linewidth]{why.jpg}
 \end{column}
 \begin{column}{.6\linewidth}
  Por qu\(\^{e}\)?
 \end{column}
\end{columns}

\begin{columns}
 \begin{column}{.4\linewidth}
  \centering
   \includegraphics[width=.75\linewidth]{roll_safe.png}
 \end{column}
 \begin{column}{.6\linewidth}
  Como?
 \end{column}
\end{columns}

### Some continuous parametric failure time models

Random variable: failure time, \(T > 0\).\newline
Type: continuous.
\noindent{\color{beamer@UIUCblue}\rule{\linewidth}{0.25mm}}

Common failure time distributions for homogeneous populations:

\begin{center}
 \begin{minipage}{.675\linewidth}

  \hfill Now, let's better understand how this works.
 \end{minipage}
\end{center}

### Generalized \(F\)

\hfill \textit{Advantage: it can adapt to a wide variety of
                          distributional shapes.}

\noindent{\color{beamer@UIUCorange}\rule{\linewidth}{0.25mm}}

\begin{minipage}{.85\linewidth}
\begin{block}{Context}
 A location and scale model for \(Y = \log T\) in which the error
 distribution is assumed to be that of the logarithm of an \(F\) variate
 on \(2m_{1}\) and \(2m_{2}\) degrees of freedom.\newline

 That is, \(Y = \mu + \sigma W\), where
 \[ f_{W}(w) =
    \frac{(m_{1}/m_{2})^{m_{1}}
          e^{wm_{1}}
          (1 + m_{1} e^{w}/m_{2})^{-(m_{1} + m_{2})}}{B(m_{1}, m_{2})}.
 \]
 The resulting model for \(T\) is the generalized \(F\) distribution.
\end{block}
\end{minipage}

### Shapes of the hazard functions

```{r, echo=FALSE}
pacman::p_load(ggplot2, latex2exp, gridExtra, pracma)

graph_exp <- ggplot(data.frame(t = seq(0, 4)), aes(x = t)) +
    stat_function(fun = function(t) { 0.5 }, size = 1) +
    ylim(0, 1) +
    labs(y = TeX("$\\lambda(t)$"), title = "Exponential") +
    theme_minimal(base_size = 16)

graph_wei <- ggplot(data.frame(t = seq(0, 4)), aes(x = t)) +
    stat_function(fun = function(t) { 0.5 * 0.5 * (0.5 * t)^(0.5 - 1) },
                  size = 1) +
    stat_function(fun = function(t) { 0.5 * 1.0 * (0.5 * t)^(1.0 - 1) },
                  linetype = 2, size = 1) +
    stat_function(fun = function(t) { 0.5 * 1.5 * (0.5 * t)^(1.5 - 1) },
                  linetype = 3, size = 1) +
    ylim(0, 1) +
    labs(y = TeX("$\\lambda(t)$"), title = "Weibull") +
    theme_minimal(base_size = 16)

graph_logn <- ggplot(data.frame(t = seq(0, 4)), aes(x = t)) +
    stat_function(fun = function(t) {
        (2 * pi)^(-0.5) * 0.5/t * exp(-0.5^2 * log(0.5 * t)^2/2)/
            (1 - pnorm(0.5 * log(0.5 * t)))
    }, size = 1) +
    stat_function(fun = function(t) {
        (2 * pi)^(-0.5) * 1.0/t * exp(-1.0^2 * log(0.5 * t)^2/2)/
            (1 - pnorm(1.0 * log(0.5 * t)))
    }, linetype = 2, size = 1) +
    stat_function(fun = function(t) {
        (2 * pi)^(-0.5) * 1.5/t * exp(-1.5^2 * log(0.5 * t)^2/2)/
            (1 - pnorm(1.5 * log(0.5 * t)))
    }, linetype = 3, size = 1) +
    ylim(0, 1) +
    labs(y = TeX("$\\lambda(t)$"), title = "Log-Normal") +
    theme_minimal(base_size = 16)

gammaincVec <- function(t, k) { gammainc(0.5 * t, k)[3] }
gammaincVec <- Vectorize(gammaincVec, "t")

graph_gam <- ggplot(data.frame(t = seq(0, 4)), aes(x = t)) +
    stat_function(fun = function(t) {
        0.5 * (0.5 * t)^(0.5 - 1) * exp(-0.5 * t)/
            (gamma(0.5) * (1 - gammaincVec(t, 0.5)))
    }, size = 1) +
    stat_function(fun = function(t) {
        0.5 * (0.5 * t)^(1.0 - 1) * exp(-0.5 * t)/
            (gamma(1.0) * (1 - gammaincVec(t, 1.0)))
    }, linetype = 2, size = 1) +
    stat_function(fun = function(t) {
        0.5 * (0.5 * t)^(1.5 - 1) * exp(-0.5 * t)/
            (gamma(1.5) * (1 - gammaincVec(t, 1.5)))
    }, linetype = 3, size = 1) +
    ylim(0, 1) +
    labs(y = TeX("$\\lambda(t)$"), title = "Gamma") +
    theme_minimal(base_size = 16)

graph_loglog <- ggplot(data.frame(t = seq(0, 4)), aes(x = t)) +
    stat_function(fun = function(t) {
        0.5 * 0.5 * (0.5 * t)^(0.5 - 1)/(1 + (0.5 * t)^0.5)
    }, size = 1) +
    stat_function(fun = function(t) {
        0.5 * 1.0 * (0.5 * t)^(1.0 - 1)/(1 + (0.5 * t)^1.0)
    }, linetype = 2, size = 1) +
    stat_function(fun = function(t) {
        0.5 * 1.5 * (0.5 * t)^(1.5 - 1)/(1 + (0.5 * t)^1.5)
    }, linetype = 3, size = 1) +
    ylim(0, 1) +
    labs(y = TeX("$\\lambda(t)$"), title = "Log-Logistic") +
    theme_minimal(base_size = 16)

grid.arrange(graph_exp, graph_wei, graph_logn,
             graph_gam, graph_loglog, nrow = 2, ncol = 3)
```

### A door to another world

To be able to see these Generalized \(F\) special cases,\newline
the transformation \(Y = \mu + \sigma W\) is necessary.

However, this open a door for another world:
\textcolor{beamer@UIUCorange}{Extreme Value Theory}.

In the Generalized Gamma case and special cases,\newline
\(W\) is an extreme value (minimum) distribution.

\noindent{\color{beamer@UIUCblue}\rule{\linewidth}{0.25mm}}

Extreme Value Theory
\newline
\hspace*{.5cm}\rotatebox[origin=c]{180}{$\Lsh$}
              Generalized extreme value (GEV) distribution
\newline
\hspace*{1cm}\rotatebox[origin=c]{180}{$\Lsh$}
             Type I extreme value distribution: Gumbel family
\newline
\hspace*{1cm}\rotatebox[origin=c]{180}{$\Lsh$}
             Type II extreme value distribution: Fr\(\'{e}\)chet family
\newline
\hspace*{1cm}\rotatebox[origin=c]{180}{$\Lsh$}
             Type III extreme value distribution: Weibull family

### Regression models\newline\hspace*{.5cm}\rotatebox[origin=c]{180}{$\Lsh$} Exponential and Weibull

Goal: obtain a regression model by allowing the failure rate\newline
      \hspace*{1cm}to be a function of the derived covariates \(Z\).
\noindent{\color{beamer@UIUCorange}\rule{\linewidth}{0.25mm}}

The hazard at time \(t\) for an individual can be written as
\[
 \lambda(t; x) = \text{hazard} \times c(Z^{\top} \beta),
\]

three forms have been used for \(c\):

+ \(c(s) = 1 + s\), corresponding to the failure rate;

+ \(c(s) = (1 + s)^{-1}\), corresponding to the mean survival time;

+ \textcolor{beamer@UIUCblue}{\(c(s) = \exp(s)\)}.

###

\begin{columns}
 \begin{column}{.475\linewidth}
  \begin{block}{Exponential regression model}
   \[
    \begin{aligned}
     \lambda(t; x) &= \lambda\exp(Z^{\top} \beta)\\
                 Y &= -\log \lambda - Z^{\top} \beta + W\\
                 W &\sim \text{Extreme Value dist.}
    \end{aligned}
   \]
  \end{block}
 \end{column}
 \begin{column}{.475\linewidth}
  \begin{block}{Weibull regression model}
   \[
    \begin{aligned}
     \lambda(t; x) &= \gamma(\lambda t)^{\gamma-1}\exp(Z^{\top} \beta)\\
                 Y &= -\log \lambda - Z^{\top} \sigma \beta + \gamma^{-1} W\\
                 W &\sim \text{Extreme Value dist.}
    \end{aligned}
   \]
  \end{block}
 \end{column}
\end{columns}

\vspace{.2cm}
\noindent{\color{beamer@UIUCorange}\rule{\linewidth}{0.25mm}}

Accelerated failure time models
\newline
\hspace*{.5cm}\rotatebox[origin=c]{180}{$\Lsh$}
              general class of log-linear models
\newline
\hspace*{1cm}\rotatebox[origin=c]{180}{$\Lsh$}
             covariates act additively on \(Y\), or multiplication on \(T\)
\newline
\hspace*{1.5cm}\rotatebox[origin=c]{180}{$\Lsh$}
               log survival time, \(Y = \log T\)
\noindent{\color{beamer@UIUCorange}\rule{\linewidth}{0.25mm}}

More general model: Relative Risk or Cox Model.

### Relative risk model

\begin{minipage}{.65\linewidth}
 \begin{block}{Cox, 1972}
  \[ \lambda(t; x) = \lambda_{0}(t) \exp(Z^{\top} \beta), \]
  where \(\lambda_{0}(\cdot)\) is an arbitrary unspecified baseline hazard
  function for continuous \(T\).
 \end{block}
\end{minipage}
\vspace{.3cm}
The conditional survivor function for \(T\) given \(Z\) is
\[
 F(t; x) = F_{0}^{\exp(Z^{\top} \beta)} (t), \quad \text{where} \quad
 F_{0}(t) = \exp\left[ -\int_{0}^{t} \lambda_{0}(u) \text{d}u \right].
\]
Thus the survivor function of \(t\) for a covariate value, \(x\), is
obtained by raising the baseline survivor function \(F_{0}(t)\) to a
power.

\noindent
{\color{beamer@UIUCorange}Nice generalizations,~\rule{.6\linewidth}{0.25mm}}

+ stratified Cox model;

+ time-dependent Cox model: *relative* risk model.

### Accelerated failure time model

Suppose \(Y = \log T\) and consider the linear model
\[
 Y = Z^{\top} \beta + W.
\]
Exponentiation gives \(T = \exp (Z^{\top} \beta)~S\), where \(S = \exp
(W) > 0\) has hazard function \(\lambda_{0}(s)\), say, that is
independent of \(\beta\).

\vspace{-.15cm}
\noindent{\color{beamer@UIUCblue}\rule{\linewidth}{0.25mm}}

The hazard function for \(T\) can be written as
\[
 \lambda(t; x) = \exp (-Z^{\top} \beta)
                 \lambda_{0} [t \exp (-Z^{\top} \beta)].
\]
The effect of the covariate is
\textcolor{beamer@UIUCorange}{multiplicative on \(t\)} rather than on
the hazard function.

\begin{minipage}{.875\linewidth}
 \begin{block}{i.e.,}
  The role of \(Z\) is to \textcolor{beamer@UIUCorange}{accelerate} (or
  decelerate) the time to failure.
 \end{block}
\end{minipage}

### Comparison of regression models

\begin{center}

\end{center}
\vspace{-.5cm}
\begin{minipage}{.65\linewidth}
 \begin{block}{note}
  Exponential and Weibull regression models can be considered as special
  cases of both models.
 \end{block}
\end{minipage}

### Discrete failure time models

Discrete failure time?

+ Grouping of continuous data due to imprecise measurement;

+ Time itself may be discrete

  + e.g., when the response time represents the number of episodes that\newline
    \hspace*{.75cm}occur prior to a terminal event.

\vspace{-.35cm}
\noindent{\color{beamer@UIUCblue}\rule{\linewidth}{0.25mm}}

Discrete regression models?

+ Grouped relative risk model;

+ Discrete and continuous relative risk model;

+ Discrete logistic model.

### Discrete regression models

+ \textcolor{beamer@UIUCblue}{Grouped relative risk model}:
\[
 \text{Discrete baseline cumulative hazard function}:
 \Lambda_{0}(t) = \sum_{a_{i} \leq t} \lambda_{i},
\]
\hspace*{.7cm}this model is the uniquely appropriate one for grouped
              data from\newline
\hspace*{.7cm}the continuous relative risk model.

+ \textcolor{beamer@UIUCblue}{Discrete and continuous relative risk model}:
\[
 \text{d}\Lambda(t; x) = \exp (Z^{\top} \beta)~\text{d}\Lambda_{0}(t),
\]
\hspace*{.7cm}which retains the multiplicative hazard relationship.

+ \textcolor{beamer@UIUCblue}{Discrete logistic model}:
\[
 \frac{\text{d}\Lambda(t; x)}{1-\text{d}\Lambda(t; x)} =
 \frac{\text{d}\Lambda_{0}(t)}{1-\text{d}\Lambda_{0}(t)} \exp (Z^{\top} \beta),
\]
\hspace*{.7cm}specifies a linear log odds model for the hazard\newline
\hspace*{.7cm}probability at each potential failure time.

###

\begin{center}
 \includegraphics[width=.9\linewidth]{thank_you.jpg}
\end{center}
