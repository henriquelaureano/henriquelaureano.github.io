---
title: "PROTF"
author: "Henrique Laureano"
format: html
editor: visual
code-line-numbers: true
code-fold: true
code-block-border-left: true
date-modified: 2025/12/27
editor_options: 
  chunk_output_type: console
toc: true
---

```{r pkgs}

if (!requireNamespace("pacman", quietly = TRUE)) 
  install.packages("pacman") 

pacman::p_load(
  ggplot2, googlesheets4, dplyr, lubridate, tidyr, stringr, ggpubr, segmented, broom
)
ggplot2::theme_set(
  theme_classic(base_size = 14) +
    theme(plot.title           = element_text(size = 14, face = "bold"),
          plot.subtitle        = element_text(size = 13, face = "bold"),
          axis.text.x          = element_text(face = "bold"),
          axis.text.y          = element_text(face = "bold"),
          axis.title.x         = element_text(hjust = 0),
          axis.title.y         = element_text(hjust = 0, angle = 360),
          strip.text           = element_text(size = 13, face = "bold"),
          legend.position      = "bottom", 
          legend.justification = "right",
          panel.grid.major     = element_line(color = "gray90", linewidth = 0.7))
)

```

# Lendo os dados

```{r protf_data, warning=FALSE, message=FALSE}

protf_url <- 
  paste0(
    "https://docs.google.com/spreadsheets/d/",
    "1k3vlSk4e4mHMwTHZVnDpSTXyMReXLTGsgk82rHVILgQ/",
    "edit?gid=402323031#gid=402323031"
)
protf <- googlesheets4::read_sheet(protf_url) |> dplyr::distinct()

protf <- protf |> 
  dplyr::mutate(
    IDADE = lubridate::time_length(
      lubridate::interval(`6 - Data de Nascimento`, 
                          `5 - Data de Cadastro do Exame`), "years"
    )
  )
```

Calculando a idade dos pacientes vemos dois casos com data de cadastro do exame anterior a sua data de nascimento.

```{r}

protf |> dplyr::filter(IDADE <= 0) |>
  dplyr::select(
    `1 - Insira o Prontuário do Paciente`,
    `5 - Data de Cadastro do Exame`,
    `6 - Data de Nascimento`
  )

```

## Atenção! Dado duplicado mas com diferenças

Nem todas as entradas são iguais. Ver com detalhe na planilha Google Sheets.

```{r}

protf |> dplyr::filter(`1 - Insira o Prontuário do Paciente` == 638992)

```


# 1. Análise epidemiológica:

## a) Porcentagem de cada faixa etária na amostra

```{r}

protf |> dplyr::count(`3 - Insira Faixa etária do paciente`) |>
  dplyr::mutate(Percentual = n / nrow(protf))

```

## b) Setores mais representativos na amostra

```{r}

protf |> dplyr::count(`2 - Insira o Setor de Solicitação do exame`) |>
  dplyr::mutate(Percentual = n / nrow(protf)) |>
  dplyr::arrange(dplyr::desc(n)) |> print(n = 28)

```

## c) Sexo

```{r}

protf |> dplyr::count(`4 - Sexo`) |>
  dplyr::mutate(Percentual = n / nrow(protf))

```

## d) Presença/ausência de quadros infecciosos e sistema mais afetado em casos positivos para quadros infecciosos

```{r}

protf |> dplyr::count(`7 - Quadros infecciosos até o momento da coleta?`) |>
  dplyr::mutate(Percentual = n / nrow(protf))

```

Em quem tem caso positivo para quadro infeccioso

```{r}

protf |> dplyr::filter(
  `7 - Quadros infecciosos até o momento da coleta?` == "Sim"
) |>
  dplyr::select(`8 - Infecção em sistema nervoso central?`,
                `9 - Infecção de vias áreas superiores?`,
                `10 - Infecção de vias áreas inferiores?`,
                `11 - Infecção de sistema urinário?`,
                `12 - Infecção de sistema gastrointestinal?`,
                `13 - Infecção de pele?`,
                `14 - Sepse?`) |>
  tidyr::pivot_longer(`8 - Infecção em sistema nervoso central?`:`14 - Sepse?`) |>
  dplyr::filter(value == "Sim") |>
  dplyr::count(name) |>
  dplyr::mutate(Percentual = n / sum(n)) |> dplyr::arrange(dplyr::desc(n))

```

Dos 374 pacientes com quadro infeccioso, 302 apresentaram em mais de um sistema (ao menos em dois). 80.75%.

Nestes 302, estes são os sintomas que aparecem e em quantos dos 302 pacientes.

```{r}

proxy <- 
  protf |> dplyr::filter(
    `7 - Quadros infecciosos até o momento da coleta?` == "Sim"
  ) |>
  dplyr::select(`1 - Insira o Prontuário do Paciente`,
                `8 - Infecção em sistema nervoso central?`,
                `9 - Infecção de vias áreas superiores?`,
                `10 - Infecção de vias áreas inferiores?`,
                `11 - Infecção de sistema urinário?`,
                `12 - Infecção de sistema gastrointestinal?`,
                `13 - Infecção de pele?`,
                `14 - Sepse?`) |>
  tidyr::pivot_longer(!`1 - Insira o Prontuário do Paciente`) |>
  dplyr::filter(value == "Sim") |>
  dplyr::group_by(`1 - Insira o Prontuário do Paciente`) |>
  dplyr::mutate(n = dplyr::n()) |>
  dplyr::ungroup() |>
  dplyr::filter(n > 1) |>
  dplyr::arrange(dplyr::desc(n), `1 - Insira o Prontuário do Paciente`) 

(
  proxy2 <- 
    proxy |>
    dplyr::select(!c(value, n)) |> 
    mutate(name = stringr::str_remove(name, "^[0-9]+ - "),
           name = stringr::str_remove(name, "\\?"),
           name = stringr::str_remove(name, "Infecção (de|em) "),
           name = stringr::str_to_sentence(name)) |>
    dplyr::count(name) |> 
    dplyr::arrange(dplyr::desc(n)) |>
    dplyr::mutate(Percentual = n / 302) 
)

```

O máximo de infecções que um paciente apresenta são 5, e 5 pacientes ficaram em tal situação.

```{r fig.height=10}

proxy |>
  dplyr::mutate(value = ifelse(value == "Sim", 1, 0)) |>
  dplyr::distinct() |> # -------------------------------------------------------
  tidyr::pivot_wider(names_from = name, values_from = value, values_fill = 0) |>
  dplyr::select(-n) |> 
  tidyr::pivot_longer(-`1 - Insira o Prontuário do Paciente`, 
                      names_to = "Infection_Type", 
                      values_to = "Present") |>
  mutate(Infection_Type = stringr::str_remove(Infection_Type, "^[0-9]+ - "),
         Infection_Type = stringr::str_remove(Infection_Type, "\\?"),
         Infection_Type = stringr::str_remove(Infection_Type, "Infecção (de|em) "),
         Infection_Type = stringr::str_to_sentence(Infection_Type)) |>
  ggplot() +
  aes(
    x = factor(Infection_Type, levels = unique(proxy2$name)), 
    y = factor(
      `1 - Insira o Prontuário do Paciente`, 
      levels = unique(proxy$`1 - Insira o Prontuário do Paciente`) |> rev()
    ), 
    fill = as.factor(Present)
  ) +
  geom_tile(color = "white") + # Adds a grid line effect
  scale_fill_manual(values = c("0" = "grey95", "1" = "steelblue"),
                    labels = c("Não", "Sim"),
                    name = "Presença: ") +
  labs(x = "Tipo de Infecção", 
       y = "Paciente",
       title = "Mapa de Calor de Infecções por Paciente",
       subtitle = "Apenas pacientes com ao menos dois tipos de infecção") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_discrete(labels = NULL)

```

## e) Porcentagem de indivíduos com comorbidade e comorbidades mais frequentes

```{r}

protf |> 
  dplyr::count(`20 - Paciente possui alguma comorbidade/diagnostico de base?`) |>
  dplyr::mutate(Percentual = n / nrow(protf))

protf |> 
  dplyr::filter(
    `20 - Paciente possui alguma comorbidade/diagnostico de base?` == "Sim"
  ) |>
  dplyr::count(`20.1 -  Qual comorbidade o paciente possui?

-Em caso negativo responder com NA`) |> 
  dplyr::mutate(Percentual = n / 642) |>
  dplyr::arrange(dplyr::desc(n)) |> 
  dplyr::filter(n > 1) |>
  print(n = 50)
  
```

Entre os 642 pacientes com comorbidade, 195 diferentes combinações de comorbidade são observadas - mas 50 aparecem em ao menos dois pacientes.

## f) Porcentagem de pacientes que realizam hemodiálise

```{r}

protf |> 
  dplyr::count(`21 - Paciente realiza hemodiálise?`) |>
  dplyr::mutate(Percentual = n / nrow(protf))
  
```

## g) Porcentagem de pacientes que passaram por cirurgia nos 30 dias antes do exame

```{r}

protf |> 
  dplyr::count(
    `22 - Paciente passou por cirurgia nos 30 dias que antecederam a realização do exame PROTF?`
  ) |>
  dplyr::mutate(Percentual = n / nrow(protf))

```

## h) Porcentagem de pacientes que passaram por tratamento oncológico nos 30 antes do exame

```{r}

protf |> 
  dplyr::count(
    `23 - Paciente passou por tratamento oncológico nos 30 dias que antecederam a realização do exame PROTF?`
  ) |>
  dplyr::mutate(Percentual = n / nrow(protf))

```

## i) Porcentagem de pacientes que fizeram uso de medicação

```{r}

protf |> 
  dplyr::count(
    `26 - Paciente faz uso de medicação que pode causar imunodeficiência nos 30 dias que antecederam a realização do exame PROTF?`
  ) |>
  dplyr::mutate(Percentual = n / nrow(protf))

```

## j) Porcentagem de pacientes com registro de óbito. Definir intervalo de tempo entre a data do exame e a data do óbito.

```{r}

protf |> 
  dplyr::count(`33 - Paciente possui registro de óbito?`) |>
  dplyr::mutate(Percentual = n / nrow(protf))

proxy <- 
  protf |> 
  dplyr::filter(`33 - Paciente possui registro de óbito?` == "Sim") |>
  dplyr::select(`1 - Insira o Prontuário do Paciente`, # ---------------------
                `5 - Data de Cadastro do Exame`, 
                `33.2 - Data de óbito`) |>
  dplyr::mutate(
    Intervalo_dias = lubridate::time_length(
      lubridate::interval(`5 - Data de Cadastro do Exame`, `33.2 - Data de óbito`), 
      "days"
    ),
    Intervalo_meses = lubridate::time_length(
      lubridate::interval(`5 - Data de Cadastro do Exame`, `33.2 - Data de óbito`), 
      "months"
    )
  )

proxy |> dplyr::select(-`1 - Insira o Prontuário do Paciente`)

summary(proxy$Intervalo_dias)
summary(proxy$Intervalo_meses)

```

147 pacientes vieram a óbito (18.4%), com um tempo médio de sobrevida de 169 dias (5.6 meses) - mediana de 35 dias (1.1 meses). 

**Atenção**! Temos um paciente com este campo em branco.

Além de outliers, temos aqui mais inconsistências nos dados (**atenção!!**). Tempo negativo.

```{r}

proxy |>
  dplyr::filter(Intervalo_dias <= 0 | Intervalo_meses <= 0)

```

# 2. Análise de indivíduos com dosagem de IgG

## a) A partir dos valores de dosagem de IgG, verificar se existe correlação com os valores de PROTF; Não considerar na estatistica os pacientes que fazem reposição de IgG - pois é um tratamento, logo não é um dado basal

118 pacientes (14.8%) tem registro do valor de IgG e não fizeram reposição.

```{r}

(
  proxy <- 
    protf |>
    dplyr::filter(
      `19 - Fez reposições de Imunoglobulinas durante os 30 dias que antecederam a realização do exame PROTF  ?`
    != "Sim" &
    `18.1 - Como se encontra o resultado de IgG?

NA = não se aplica` != "NA"
    ) |> 
    dplyr::rename(IgG = `18.2 - Qual resultado da dosagem? Colocar apenas número

-Responder com NA em caso de não realização do exame`) |>
    dplyr::rename(PROTF = `16 - Resultado do Primeiro exame`) |>
    dplyr::select(IgG, PROTF) |>
    tidyr::unnest(IgG)  
)

```

Correlação linear de Pearson de 0.43 (forte e estatísticamente significativa, 1.2e-06 = 0.0000012).

Contudo, vemos que o que melhor se adequa aos dados é um comportamento quadrático - subida linear (não tão forte) até um igG ao redor de 600 e a partir dali uma curva descendente, mas temos poucos pacientes passando desse valor.

```{r fig.width=8}

proxy |>
  ggplot() +
  aes(x = IgG, y = PROTF) +
  geom_point(size = 3, shape = 21, fill = "steelblue", alpha = 0.6) +
  geom_smooth(method = "lm", 
              formula = y ~ poly(x, 2), 
              color = "red", 
              se = TRUE) + 
  ggpubr::stat_cor(method = "pearson", label.x = 1100, label.y = 1.3) + 
  labs(title = "Correlação entre IgG e PROTF",
       subtitle = "Modelo Linear Quadrático (y ~ x²) com banda de confiança de 95%",
       x = "IgG (mg/dL)", y = "PROTF (g/L)") +
  scale_x_continuous(breaks = seq(0, 1500, by = 100)) +
  scale_y_continuous(breaks = seq(0, 3, by = 0.1))

```

## b) Entre os indivíduos com dosagem de IgG abaixo do valor de referência, qual foi o valor médio, mínimo e máximo do valor de PROTF?

```{r fig.width=8}

protf |>
  dplyr::count(
    `18.1 - Como se encontra o resultado de IgG?

NA = não se aplica`
    ) 

proxy <- 
  protf |>
    dplyr::filter(
    `18.1 - Como se encontra o resultado de IgG?

NA = não se aplica` == "Abaixo do valor de referência"
    ) |> 
    dplyr::rename(IgG = `18.2 - Qual resultado da dosagem? Colocar apenas número

-Responder com NA em caso de não realização do exame`) |>
    dplyr::rename(PROTF = `16 - Resultado do Primeiro exame`) |>
    dplyr::select(IgG, PROTF) |>
    tidyr::unnest(IgG) 

summary(proxy$PROTF)

proxy |>
  ggplot() +
  aes(x = IgG, y = PROTF) +
  geom_point(size = 3, shape = 21, fill = "steelblue", alpha = 0.6) +
  geom_smooth(method = "lm", 
              formula = y ~ poly(x, 1), 
              color = "red", 
              se = TRUE) + 
  ggpubr::stat_cor(method = "pearson", label.x = 400, label.y = 1.3) + 
  labs(title = "Correlação entre IgG e PROTF",
       subtitle = "Modelo Linear (y ~ x) com banda de confiança de 95%",
       x = "IgG (mg/dL)", y = "PROTF (g/L)") +
  scale_x_continuous(breaks = seq(0, 550, by = 50)) +
  scale_y_continuous(breaks = seq(0, 3, by = 0.1))
  
```

PROTF médio de 1.745, min 1.2 e máx 2.4.

## c) Entre os indivíduos com dosagem de IgG acima do valor de referência e que NÃO fazem reposição de IgG, qual foi o valor médio, mínimo e máximo do valor de PROTF?

Apenas um paciente com IgG acima do valor de referência (ele também não fez reposição de IgG).

```{r}

protf |>
    dplyr::filter(
    `18.1 - Como se encontra o resultado de IgG?

NA = não se aplica` == "Acima do valor de referência" &
  `19 - Fez reposições de Imunoglobulinas durante os 30 dias que antecederam a realização do exame PROTF  ?`
    != "Sim"
    )  |> 
    dplyr::rename(IgG = `18.2 - Qual resultado da dosagem? Colocar apenas número

-Responder com NA em caso de não realização do exame`) |>
    dplyr::rename(protf = `16 - Resultado do Primeiro exame`) |>
    dplyr::select(IgG, protf) |>
    tidyr::unnest(IgG) 

```

## d) Entre os indivíduos com dosagem de IgG abaixo do valor de referência, quantos possuíam comorbidade? Quais eram mais frequentes?

62 pacientes, 31 diferentes combinações de comorbidades - apenas 6 ocorrendo em ao menos dois pacientes.

```{r}

protf |>
  dplyr::filter(
    `18.1 - Como se encontra o resultado de IgG?

NA = não se aplica` == "Abaixo do valor de referência"
  ) |>
  dplyr::count(`20 - Paciente possui alguma comorbidade/diagnostico de base?`)

protf |>
  dplyr::filter(
    `18.1 - Como se encontra o resultado de IgG?

NA = não se aplica` == "Abaixo do valor de referência" &
  `20 - Paciente possui alguma comorbidade/diagnostico de base?` == "Sim"
  ) |>
  dplyr::count(`20.1 -  Qual comorbidade o paciente possui?

-Em caso negativo responder com NA`) |>
  dplyr::arrange(dplyr::desc(n)) |>
  dplyr::filter(n > 1)

```

# 3. Análise dos menores de 1 ano

## a) Entre os menores de 1 ano, quantos apresentavam a comorbidade "Prematuridade"?

Dentre os 202 pacientes temos 77 diferentes combinações de comorbidades.

```{r}

protf |>
  dplyr::count(`3 - Insira Faixa etária do paciente`)

protf |>
  dplyr::filter(`3 - Insira Faixa etária do paciente` == "< 1 ano") |>
  dplyr::count(`20 - Paciente possui alguma comorbidade/diagnostico de base?`)

# protf |>
#   dplyr::filter(
#     `3 - Insira Faixa etária do paciente` == "< 1 ano"
#   ) |>
#     dplyr::rename(Comorbidade = `20.1 -  Qual comorbidade o paciente possui?
# 
# -Em caso negativo responder com NA`) |>
#   dplyr::count(Comorbidade)

protf |>
  dplyr::rename(Comorbidade = `20.1 -  Qual comorbidade o paciente possui?

-Em caso negativo responder com NA`) |>
  dplyr::filter(
    `3 - Insira Faixa etária do paciente` == "< 1 ano" &
    stringr::str_detect(Comorbidade, "Prematuridade")
  ) |>
  dplyr::count(Comorbidade) |>
  dplyr::arrange(dplyr::desc(n))

```

Destas 77, 20 apresentam "Prematuridade".

## b) Levando em consideração pacientes que fizeram os exames PROTF + IgG, definir um valor de referência para PROTF levando como referência a dosagem de IgG

126 pacientes, descartaremos da análise aquele único paciente com IgG acima do valor de referência.

```{r fig.width=8.5}

(
  proxy <- 
    protf |>
    dplyr::rename(IgG_Referência = `18.1 - Como se encontra o resultado de IgG?

NA = não se aplica`) |>
    dplyr::rename(IgG = `18.2 - Qual resultado da dosagem? Colocar apenas número

-Responder com NA em caso de não realização do exame`) |>
    dplyr::rename(PROTF = `16 - Resultado do Primeiro exame`) |>
    dplyr::filter(IgG_Referência != "NA") |> 
    dplyr::select(IgG, PROTF, IgG_Referência) |>
    tidyr::unnest(IgG)  
)

proxy |> dplyr::count(IgG_Referência)

proxy |>
  ggplot() +
  aes(x = IgG, y = PROTF, fill =IgG_Referência, color = IgG_Referência) +
  geom_point(size = 3, shape = 21, alpha = 0.6) +
  geom_smooth(method = "lm", 
              formula = y ~ poly(x, 1), 
              color = "red", 
              se = TRUE) + 
  ggpubr::stat_cor(method = "pearson", 
                   label.x.npc = 0.7,   # 70% across the x-axis
                   label.y.npc = "bottom") + 
  labs(title = "Correlação entre IgG e PROTF",
       subtitle = "Modelo Linear (y ~ x) com banda de confiança de 95%",
       fill = "Referência: ", color = "Referência: ",
       x = "IgG (mg/dL)", y = "PROTF (g/L)") +
  scale_x_continuous(breaks = seq(0, 1500, by = 100)) +
  scale_y_continuous(breaks = seq(1, 3, by = 0.1))

(
  ref_stats <- proxy |>
    filter(IgG_Referência == "Normal") |>
    summarise(
      mean_protf = mean(PROTF),
      sd_protf = sd(PROTF),
      upper_ref = mean_protf + (2 * sd_protf),
      lower_ref = mean_protf - (2 * sd_protf)
    )
)

```

Valor de referência: 2.02 (95% CI 1.50, 2.54).

```{r fig.width=9, fig.height=6}

lin_mod <- lm(
  PROTF ~ IgG, 
  data = proxy |> dplyr::filter(IgG_Referência != "Acima do valor de referência")
)

# Fit a segmented model (it estimates where the 'plateau' starts)
# You provide an initial guess for the breakpoint (e.g., IgG = 600)
seg_mod <- segmented(lin_mod, seg.Z = ~IgG, psi = 600)

# seg_mod$psi[, "Est."] + c(-1.95, 1.96) * seg_mod$psi[, "St.Err"]

proxy |>
  filter(IgG_Referência != "Acima do valor de referência") |>
  ggplot(aes(x = IgG, y = PROTF)) +
  annotate("rect", xmin = -Inf, xmax = Inf, 
           ymin = ref_stats$lower_ref, ymax = ref_stats$upper_ref, 
           fill = "steelblue", alpha = 0.3) +
  annotate("segment", x = -Inf, xend = Inf, 
           y = ref_stats$mean_protf, yend = ref_stats$mean_protf, 
           color = "steelblue", linetype = "dashed", linewidth = 1) +
  geom_point(aes(fill = IgG_Referência), shape = 21, size = 3, alpha = 0.8) +
  geom_smooth(
    aes(color = IgG_Referência), 
    method = "lm", formula = y ~ poly(x, 1), se = TRUE, linewidth = 1
  ) +
  geom_vline(xintercept = seg_mod$psi[, "Est."], linetype = "dashed", alpha = 0.7) +
  scale_fill_manual(
    values = c("Normal" = "white", "Abaixo do valor de referência" = "orange"),
    labels = c("Abaixo da Referência", "Normal")
  ) +
  scale_color_manual(
    values = c("Normal" = "darkblue", "Abaixo do valor de referência" = "darkorange"),
    labels = c("Abaixo da Referência", "Normal")
  ) +
  labs(
    title = "Baseline de PROTF Baseado no Platô de IgG (Grupo Normal)",
    subtitle = "Linhas de tendência com Intervalo de Confiança de 95% (sombreado)",
    x = "IgG (mg/dL)", 
    y = "PROTF (g/L)",
    fill = "Classificação IgG: ", color = "Classificação IgG: "
  ) +
  scale_x_continuous(breaks = seq(0, 1500, by = 100)) +
  scale_y_continuous(breaks = seq(1, 2.5, by = 0.1))

```

Além disso, estimamos um ponto de corte para ver onde se inicia o platô - onde termina o padrão de crescimento e se inicia a estagnação de PROTF médio em relação ao IgG, é em 423.

```{r}

summary(seg_mod)

```

Aqui é apenas para "comprovar" que o grupo "Normal" não tem inclinação estatísticamente significativa. Neste grupo, independente do valor de IgG se espera o mesmo valor de PROTF.

```{r}

proxy |>
  dplyr::filter(IgG_Referência != "Acima do valor de referência") |>
  dplyr::group_by(IgG_Referência) |>
  dplyr::group_modify(~ broom::tidy(lm(PROTF ~ IgG, data = .x), conf.int = TRUE)) |>
  dplyr::filter(term == "IgG") |>
  dplyr::select(IgG_Referência, estimate, std.error, p.value, conf.low, conf.high)

```

## Explicação mais detalhada

### 1. Establishment of the Baseline Reference

To define a physiological PROTF baseline, the Normal Group (patients with IgG within the reference range) was used as the normative standard.

* **Process:** We calculated the mean and standard deviation (SD) for the Normal group. The shaded area in the visualization represents the Mean ± 2 SD, covering approximately 95% of the expected physiological variation.

* **Interpretation:** PROTF values falling below this band indicate a pathological deficit relative to the established biological baseline.

### 2. Group Dynamics: The "Rise vs. Plateau" Effect

The relationship was modeled separately for each group to identify how IgG deficiency impacts PROTF measurements.

* **Below Reference Group:** This group exhibits a significant positive slope (p < 0.05). This demonstrates that in patients with low IgG, PROTF is "coupled" to IgG levels—as IgG increases, PROTF rises proportionally.

* **Normal Group:** This group shows a slope near zero (the confidence interval includes zero). This confirms a Plateau effect, where PROTF reaches a steady state and no longer responds to further IgG increases, representing the true biological baseline.

### 3. Segmented Regression (Inflection Point)

A Segmented (Broken-stick) Regression was applied to mathematically determine the threshold of stabilization.

* **The Breakpoint:** The model identifies the specific IgG coordinate where the linear rise ends and the plateau begins. 

* **Clinical Utility:** This point defines the "Critical IgG Threshold" required for a PROTF measurement to be considered stable and diagnostically reliable, independent of hypogammaglobulinemia interference.

---

### Summary of Statistical Findings

A positive linear dependency was observed between PROTF and IgG strictly within the deficient group (p < 0.05). Conversely, the normal group exhibited a plateau (p > 0.05), establishing a stable reference baseline.

# Methodology & References

All analyses were conducted using the `R` language and environment for statistical computing (R Core Team, 2025). Data manipulation and string processing were performed using `dplyr` (Wickham et al., 2023), `tidyr` (Wickham et al., 2024), and `stringr` (Wickham, 2023). Temporal data were handled with `lubridate` (Grolemund & Wickham, 2011).

To date, the study has focused on data cleaning, feature engineering, and advanced visualization using `ggplot2` (Wickham, 2016). A key objective was the identification of biological cutoff points for PROTF where existing references were unknown or required validation. To achieve this, we utilized a two-step modeling approach:

1. **Reference Interval Modeling:** We established biological baselines by calculating the mean and standard deviation (± 2 SD) of the "Normal" IgG cohort, treating this group as a stable physiological standard.
2. **Threshold Discovery via Segmented Regression:** To identify the specific IgG level at which PROTF stabilize, we implemented segmented (broken-stick) regression (Muggeo, 2008). This allowed us to mathematically determine the "inflection point" between the rising deficient phase and the steady-state plateau phase.

Statistical significance of the observed slopes and the fit of the resulting plateaus were verified using tidied coefficients extracted via `broom` (Robinson et al., 2024).

<!-- In the next steps, we plan to expand these associations using generalized linear models (GLMs - McCullagh & Nelder, 1989) and generalized additive models (GAMs - Hastie & Tibshirani, 1990; Wood, 2017) to account for potential non-linear effects across the broader dataset. -->

## References

> R Core Team (2025). *R: A Language and Environment for Statistical Computing*. R Foundation for Statistical Computing, Vienna, Austria. <https://www.R-project.org/>.
>
> Wickham, H. (2016). *ggplot2: Elegant Graphics for Data Analysis*. Springer-Verlag New York.
>
> Wickham, H., François, R., Henry, L., Müller, K., & Vaughan, D. (2023). *dplyr: A Grammar of Data Manipulation*. R package version 1.1.4.
>
> Wickham, H., Vaughan, D., & Girlich, M. (2024). *tidyr: Tidy Messy Data*. R package version 1.3.1.
>
> Wickham, H. (2023). *stringr: Simple, Consistent Wrappers for Common String Operations*. R package version 1.5.1.
>
> Robinson, D., Hayes, A., & Couch, S. (2024). *broom: Glance, Tidy, and Augment Regression Models*. R package version 1.0.6.
> 
> Muggeo, V. M. R. (2008). *segmented: an R Package to Fit Regression Models with Broken-Line Relationships*. R News, 8/1, 20-25.
>
> Garrett Grolemund, Hadley Wickham (2011). *Dates and Times Made Easy with lubridate*. Journal of Statistical Software, 40(3), 1-25.
<!-- > -->
<!-- > McCullagh, P., & Nelder, J. A. (1989). *Generalized Linear Models* (2nd ed.). Chapman & Hall. -->
<!-- > -->
<!-- > Hastie, T., & Tibshirani, R. (1990). *Generalized Additive Models*. Chapman & Hall. -->
<!-- > -->
<!-- > Wood, S. N. (2017). *Generalized Additive Models: An Introduction with R* (2nd ed.). CRC Press. -->